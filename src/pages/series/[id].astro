---
import { getSeries, getSeriesDetail, getProducts } from "../../utils/microcms";
import BaseLayout from "../../layouts/BaseLayout.astro";
import ProductCardByMicrocms from "../../components/ProductCardByMicrocms.astro";

export async function getStaticPaths() {
  const response = await getSeries({ fields: ["id"] });
  return response.contents.map((content: any) => ({
    params: {
      id: content.id,
    },
  }));
}

const title = "Astro + Shopify";
const { id } = Astro.params;
const series = await getSeriesDetail(id as string);

const products = await getProducts({
  filters: `series[contains]${id}`,
  limit: 100
});
---

<BaseLayout title={title}>
  <div class="col-span-10">
    <p class="text-xs">
      Series :
    </p>
    <h2 class="mt-3 text-2xl">
      {series.title}
    </h2>
    <p class="mt-4 text-sm">
      {series.text}
    </p>
    <div class="mt-12">
      <h3 class="text-xs">Designer</h3>
      <div class="mt-3">
        {series.designers.map((designer: any) => (
          <a href={`/designers/${designer.id}`} class="block text-2xl underline underline-offset-6 hover:no-underline">
            {designer.nameJa}
          </a>
        ))}
      </div>
    </div>
  </div>
  <div class="col-span-10 grid grid-cols-subgrid gap-10 mt-19">
  {products.contents.map((product: any) => (
    <ProductCardByMicrocms product={product} className="col-span-2"/>
  ))}
  </div>
</BaseLayout>